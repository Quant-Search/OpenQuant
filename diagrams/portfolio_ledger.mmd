flowchart TD
  A[Allocation JSON] --> B[Targets (Key, Weight)]
  P[PortfolioState] --> C[Compute Rebalance Orders]
  M[MarketSnapshot Prices] --> C
  C --> D[Execute Orders (fees, slippage)]
  D --> E[Order Fills]
  D --> P2[Update Holdings & Cash]
  E --> L1[portfolio_trades]
  P2 --> L2[portfolio_positions]
  P2 --> L3[Compute Equity]
  L3 --> L4[portfolio_equity]
  L1 --> S[Dashboard]
  L2 --> S
  L4 --> S

